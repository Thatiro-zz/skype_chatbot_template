### OBJECTIVE

This Skype connector extends from the [Chatbot API Connector](https://github.com/inbenta-integrations/skype_chatbot_template) library, and both libraries are required as a dependencies in the final UI. This library includes a Skype API Client in order to send messages to Skype users. It translates Skype's messages into the Inbenta Chatbot API format and vice versa. Also, it implements some methods from the base HyperChat client in order to communicate with Skype when the user is having a chat.


### FUNCTIONALITIES
This connector inherits the functionalities from the `ChatbotConnector` library. Currently the features provided by that application are:

* Simple answers
* Multiple options
* Polar questions
* Chained answers
* Content ratings (yes/no + comment)
* Escalate to HyperChat after a number of no-results answers
* Escalate to HyperChat when matching with an 'Escalation FAQ'
* Send information to webhook through forms

### HOW TO CUSTOMIZE

**Custom Behaviours**

If you need to customize the bot flow you need to modify the class `SkypeConnector.php`. This class extends from ChatbotConnector and here you can override all the parent methods.


### STRUCTURE

The `SkypeConnector` folder has some classes needed to use the ChatbotConnector with Skype. This classes are used at SkypeConnector constructor in order to provide the application with the components needed to send information to Skype, parse messages between Skype, ChatbotAPI and HyperChat.

**External API folder**

Inside this folder there is the Skype API client. Allows the bot to send messages and handling authorization events.


**External Digester folder**

Here there is the class SkypeDigester. This class is a kind of "translator" between Chatbot API and Skype. Mainly, the work performed by this class is to convert a message from the Chatbot API into a message accepted by the Skype API. It also does the inverse work, translating messages from Skype into the format required by the Chatbot API.


**HyperChat API**

The class `SkypeHyperChatClient` instantiates a Skype client from the `extraInfo` user data provided by HyperChat. This data is generated by the external client and passed to HyperChat when the chat is created. This data allows us to instantiate a new Skype client:
```php
    protected function instanceExternalClient($externalId, $appConf)
    {
        $request = file_get_contents('php://input');
        $creator = self::getCreatorFromEvent($appConf->get('chat.chat'), json_decode($request, true));

        if (isset($creator->extraInfo) && isset($creator->extraInfo->skypeData)) {
            // Instance new Skype API Client
            $externalClient = new SkypeAPIClient($appConf->get('skype.app_id'), $appConf->get('skype.app_password'), $request);
            $externalClient->setActivityPropertiesFromHyperChat(json_decode($creator->extraInfo->skypeData, true));
            return $externalClient;
        }
        return null;
    }
```

This class extends from the class `HyperChatClient` that extends from the default HyperChatClient provided by product, and all the parent methods can be override.
